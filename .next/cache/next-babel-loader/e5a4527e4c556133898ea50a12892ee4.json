{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { Fragment } from \"react\";\nimport { useState } from \"react\";\nimport Image from \"../common/src/components/Image\";\nconst heartImage = \"/image/charity/heart-alt.svg\";\nimport Head from \"next/head\";\nimport Sticky from \"react-stickynode\";\nimport { ThemeProvider } from \"styled-components\";\nimport { charityTheme } from \"../common/src/theme/charity\";\nimport { ResetCSS } from \"../common/src/assets/css/style\";\nimport { DrawerProvider } from \"../common/src/contexts/DrawerContext\";\nimport Navbar from \"../containers/Charity/Navbar\";\nimport DrawerSection from \"../containers/Charity/DrawerSection\";\nimport Footer from \"../containers/Charity/Footer\";\nimport { GlobalStyle, CharityWrapper, ContentWrapper } from \"../containers/Charity/charity.style\";\nimport { Box, Container, Typography, Grid, Paper, Divider } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Button from \"../common/src/components/Button\";\nimport Heading from \"../common/src/components/Heading\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { DropzoneArea } from \"material-ui-dropzone\";\nimport axios from \"axios\";\nimport { useRouter } from \"next/router\";\nimport { useFormik } from \"formik\";\nimport * as Yup from \"yup\";\nimport { useQuery, useMutation } from \"@apollo/react-hooks\";\nimport { CREATE_ORGANIZATION, REGISTER } from \"../lib/mutations\";\nexport default (() => {\n  const router = useRouter();\n  const {\n    0: formValues,\n    1: setFormValues\n  } = useState(\"\");\n  const {\n    0: loginLoading,\n    1: setLoginLoading\n  } = useState(false);\n  const {\n    0: loginError,\n    1: setLoginError\n  } = useState(null);\n  const {\n    0: filedIds,\n    1: setFileIDs\n  } = useState([]);\n  const {\n    0: regFile,\n    1: setRegFile\n  } = useState(null);\n  const {\n    0: taxFile,\n    1: setTaxFile\n  } = useState(null);\n  const [registerUser] = useMutation(REGISTER, {\n    onCompleted: data => {\n      console.log(data);\n      router.push(\"/signin\");\n    },\n    onError: ({\n      graphQLErrors,\n      networkError\n    }) => {\n      console.log(\"Register Error\");\n      setLoginError(\"User already exists\");\n      setLoginLoading(false);\n    }\n  });\n  const [createOrganization] = useMutation(CREATE_ORGANIZATION, {\n    onCompleted: data => {\n      console.log(data, \"Organization\");\n      registerUser({\n        variables: {\n          fields: {\n            data: {\n              organization: data.createOrganization.organization.id,\n              username: formValues.email.split(\"@\")[0],\n              email: formValues.email,\n              password: formValues.password,\n              confirmed: true,\n              isDonor: false\n            }\n          }\n        }\n      });\n    },\n    onError: ({\n      networkError,\n      graphQLErrors\n    }) => {\n      console.log(networkError.result, graphQLErrors, \"Donor Signup\");\n      setLoginError(\"Sorry, an error occured, try again\");\n      setLoginLoading(false);\n    }\n  });\n  const schemas = [{\n    email: Yup.string().email(\"Email not valid\").required(\"Please Enter Your Email\"),\n    orgName: Yup.string().required(\"Please Enter Organization Name\"),\n    address: Yup.string().required(\"Please Enter Organization Address\"),\n    regNumber: Yup.string().required(\"Please Enter Registration Number\"),\n    password: Yup.string().required(\"Please Enter Password\"),\n    fullName: Yup.string().required(\"Please Enter Full Name\"),\n    mobileNumber: Yup.string().required(\"Please Enter Your Mobile Number\"),\n    confirmPassword: Yup.string().oneOf([Yup.ref(\"password\"), null], \"Passwords must match\").required(\"Pleaser confirm password\")\n  }];\n  const {\n    handleBlur,\n    handleChange,\n    handleSubmit,\n    handleReset,\n    values,\n    touched,\n    errors,\n    setFieldValue\n  } = useFormik({\n    initialValues: {\n      orgName: \"\",\n      regNumber: \"\",\n      address: \"\",\n      fullName: \"\",\n      email: \"\",\n      mobileNumber: \"\",\n      password: \"\",\n      confirmPassword: \"\"\n    },\n    onSubmit: values => {\n      console.log(values);\n      setLoginLoading(true);\n      setLoginError(null);\n      setFormValues(values);\n      createOrganization({\n        variables: {\n          fields: {\n            data: {\n              organizationName: values.orgName,\n              focalPerson: values.fullName,\n              registrationNumber: values.regNumber,\n              mobileNumber: values.mobileNumber,\n              registrationCertificate: regFile ? regFile.id : null,\n              taxExemptionForm: taxFile ? taxFile.id : null\n            }\n          }\n        }\n      });\n    },\n    validationSchema: Yup.object().shape(schemas[0])\n  });\n\n  const handlefiles = async (files, type) => {\n    setLoginLoading(true);\n    console.log(files, type);\n\n    if (files.length) {\n      const form = new FormData();\n      files.forEach(file => {\n        form.append(\"files\", file);\n      });\n      await axios.post(\"http://localhost:1337/upload\", form, {\n        headers: {\n          \"Content-type\": \"multipart/form-data\"\n        }\n      }).then(res => {\n        console.log(res.data); //setFileIDs([...filedIds, ...res.data]);\n\n        if (type == \"registration\") {\n          setRegFile(res.data[0]);\n        }\n\n        if (type == \"tax\") {\n          setTaxFile(res.data[0]);\n        }\n\n        setLoginLoading(false);\n      });\n    }\n  };\n\n  return __jsx(ThemeProvider, {\n    theme: charityTheme\n  }, __jsx(Fragment, null, __jsx(Head, null, __jsx(\"title\", null, \"Register your organization | Esaar\"), __jsx(\"meta\", {\n    name: \"Description\",\n    content: \"React next landing page\"\n  }), __jsx(\"meta\", {\n    name: \"theme-color\",\n    content: \"#FCF22B\"\n  }), __jsx(\"meta\", {\n    name: \"viewport\",\n    content: \"width=device-width, initial-scale=1.0\"\n  }), __jsx(\"link\", {\n    href: \"https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800&display=swap\",\n    rel: \"stylesheet\"\n  })), __jsx(ResetCSS, null), __jsx(GlobalStyle, null), __jsx(CharityWrapper, null, __jsx(Sticky, {\n    top: 0,\n    innerZ: 9999,\n    activeClass: \"sticky-nav-active\"\n  }, __jsx(Navbar, null)), __jsx(DrawerProvider, null, __jsx(DrawerSection, null)), __jsx(ContentWrapper, null, __jsx(Grid, {\n    container: true,\n    style: {\n      maxWidth: \"1170px\",\n      minHeight: \"100vh\",\n      paddingTop: \"140px\",\n      marginLeft: \"170px\"\n    }\n  }, __jsx(Grid, {\n    item: true,\n    md: 2\n  }), __jsx(Grid, {\n    item: true,\n    md: 8,\n    style: {\n      marginLeft: \"30px\"\n    }\n  }, __jsx(Paper, {\n    style: {\n      height: \"100%\"\n    }\n  }, __jsx(Container, {\n    style: {\n      padding: \"40px\"\n    }\n  }, \" \", __jsx(Heading, {\n    content: \"Register your organization\",\n    color: \"#05B890\"\n  }), \" \", __jsx(Divider, null), __jsx(Grid, {\n    container: true\n  }, __jsx(Grid, {\n    item: true,\n    md: 5,\n    style: {\n      marginTop: \"30px\"\n    }\n  }, __jsx(Heading, {\n    content: \"Organization Name\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"orgName\",\n    id: \"outlined-basic\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.orgName && touched.orgName,\n    helperText: errors.orgName && touched.orgName ? errors.orgName : null,\n    label: \"\",\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Focal Person\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"fullName\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.fullName && touched.fullName,\n    helperText: errors.fullName && touched.fullName ? errors.fullName : null,\n    label: \"\",\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Email ID\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    id: \"outlined-basic\",\n    label: \"\",\n    type: \"email\",\n    name: \"email\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.email && touched.email,\n    helperText: errors.email && touched.email ? errors.email : null,\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Password\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    label: \"\",\n    name: \"password\",\n    onChange: handleChange,\n    type: \"password\",\n    value: values.password,\n    onBlur: handleBlur,\n    fullWidth: true,\n    error: errors.password && touched.password,\n    helperText: errors.password && touched.password ? errors.password : null\n  })), __jsx(Grid, {\n    item: true,\n    md: 1\n  }), __jsx(Grid, {\n    item: true,\n    md: 5,\n    style: {\n      marginTop: \"30px\"\n    }\n  }, __jsx(Heading, {\n    content: \"Registration Number\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"regNumber\",\n    id: \"outlined-basic\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.regNumber && touched.regNumber,\n    helperText: errors.regNumber && touched.regNumber ? errors.regNumber : null,\n    label: \"\",\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Contact Number\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    id: \"outlined-basic\",\n    name: \"mobileNumber\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.mobileNumber && touched.mobileNumber,\n    helperText: errors.mobileNumber && touched.mobileNumber ? errors.mobileNumber : null,\n    label: \"\",\n    size: \"small\",\n    style: {\n      color: \"#05B890\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Address\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"address\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.address && touched.address,\n    helperText: errors.address && touched.address ? errors.address : null,\n    label: \"\",\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Confirm Password\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    label: \"\",\n    name: \"confirmPassword\",\n    onChange: handleChange,\n    type: \"password\",\n    value: values.confirmPassword,\n    onBlur: handleBlur,\n    fullWidth: true,\n    error: errors.confirmPassword && touched.confirmPassword,\n    helperText: errors.confirmPassword && touched.confirmPassword ? errors.confirmPassword : null\n  }))), __jsx(Grid, {\n    item: true,\n    md: 12,\n    style: {\n      marginTop: \"30px\"\n    }\n  }, __jsx(Heading, {\n    content: \"Documents\",\n    color: \"#05B890\"\n  }), __jsx(Divider, null), __jsx(Heading, {\n    content: \"Registration Certificate\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(DropzoneArea, {\n    acceptedFiles: [\"image/*\"],\n    dropzoneText: \"Drag and drop images here or click\",\n    onChange: files => handlefiles(files, \"registration\")\n  }), __jsx(Heading, {\n    content: \"Tax Exemption Form\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(DropzoneArea, {\n    acceptedFiles: [\"image/*\"],\n    dropzoneText: \"Drag and drop images here or click\",\n    onChange: files => handlefiles(files, \"tax\")\n  }), __jsx(Grid, {\n    container: true,\n    item: true,\n    md: 12,\n    style: {\n      alignContent: \"center\"\n    }\n  }, loginError ? __jsx(Text, {\n    content: loginError\n  }) : null), __jsx(Grid, {\n    container: true,\n    item: true,\n    md: 12,\n    style: {\n      alignContent: \"center\"\n    }\n  }, __jsx(Button, {\n    title: \"Create Account\",\n    variant: \"extendedFab\",\n    onClick: handleSubmit,\n    disabled: loginLoading,\n    isLoading: loginLoading,\n    style: {\n      marginTop: \"20px\",\n      marginLeft: \"230px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      minWidth: \"200px\",\n      height: \"auto\"\n    }\n  })))))))), __jsx(Footer, null))));\n});","map":null,"metadata":{},"sourceType":"module"}