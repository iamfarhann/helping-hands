{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nvar __jsx = React.createElement;\nimport React, { Fragment, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { useState } from \"react\";\nimport Text from \"../common/src/components/Text\";\nimport Image from \"../common/src/components/Image\";\nimport Head from \"next/head\";\nimport Sticky from \"react-stickynode\";\nimport { ThemeProvider } from \"styled-components\";\nimport { charityTheme } from \"../common/src/theme/charity\";\nimport { ResetCSS } from \"../common/src/assets/css/style\";\nimport { DrawerProvider } from \"../common/src/contexts/DrawerContext\";\nimport Navbar from \"../containers/Charity/Navbar\";\nimport DrawerSection from \"../containers/Charity/DrawerSection\";\nimport Footer from \"../containers/Charity/Footer\";\nimport { GlobalStyle, CharityWrapper, ContentWrapper } from \"../containers/Charity/charity.style\";\nimport { Box, Container, Typography, Grid, Paper, Divider } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Button from \"../common/src/components/Button\";\nimport Heading from \"../common/src/components/Heading\";\nimport AccountCircleIcon from \"@material-ui/icons/AccountCircle\";\nimport BusinessCenterIcon from \"@material-ui/icons/BusinessCenter\";\nimport AssessmentIcon from \"@material-ui/icons/Assessment\";\nimport PowerSettingsNewIcon from \"@material-ui/icons/PowerSettingsNew\";\nimport TextField from \"@material-ui/core/TextField\";\nimport PasswordField from \"material-ui-password-field\";\nimport { DropzoneArea } from \"material-ui-dropzone\";\nimport axios from \"axios\";\nimport cookie from \"js-cookie\";\nimport { useRouter } from \"next/router\";\nimport { useData, useDispatchUser } from \"../lib/userData\";\nimport { useFormik } from \"formik\";\nimport * as Yup from \"yup\";\nimport { useQuery, useMutation } from \"@apollo/react-hooks\";\nimport { UPDATE_ORGANIZATION } from \"../lib/mutations\";\nvar useStyles = makeStyles(function (theme) {\n  return {\n    root: {\n      width: \"100%\",\n      maxWidth: 360,\n      backgroundColor: theme.palette.background.paper\n    }\n  };\n});\n\nfunction ListItemLink(props) {\n  return __jsx(ListItem, _extends({\n    button: true,\n    component: \"a\"\n  }, props));\n}\n\nexport default (function () {\n  var classes = useStyles();\n  var dispatch = useDispatchUser();\n  var organization = useData(); //returns context\n\n  var _useState = useState([]),\n      filedIds = _useState[0],\n      setFileIDs = _useState[1];\n\n  var _useState2 = useState(null),\n      logo = _useState2[0],\n      setLogo = _useState2[1];\n\n  var _useState3 = useState(null),\n      cover = _useState3[0],\n      setCover = _useState3[1];\n\n  var _useState4 = useState(null),\n      regFile = _useState4[0],\n      setRegFile = _useState4[1];\n\n  var _useState5 = useState(null),\n      taxFile = _useState5[0],\n      setTaxFile = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      formValues = _useState6[0],\n      setFormValues = _useState6[1];\n\n  var _useState7 = useState(false),\n      updateLoading = _useState7[0],\n      setUpdateLoading = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      updateError = _useState8[0],\n      setUpdateError = _useState8[1];\n\n  var _useState9 = useState(false),\n      fileLoading = _useState9[0],\n      setFileLoading = _useState9[1];\n\n  var _useState10 = useState(\"\"),\n      fileError = _useState10[0],\n      setFileError = _useState10[1];\n\n  var _useMutation = useMutation(UPDATE_ORGANIZATION, {\n    onCompleted: function onCompleted(data) {\n      console.log(data);\n      dispatch({\n        type: \"UPDATE\",\n        payload: data.updateOrganization.organization\n      });\n      setUpdateError(\"Changes saved succesfully!\");\n      setUpdateLoading(false);\n    },\n    onError: function onError(error) {\n      console.log(error);\n      setUpdateError(\"Sorry an error occurred. Please try again!\");\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      updateOrganization = _useMutation2[0];\n\n  var _useMutation3 = useMutation(UPDATE_ORGANIZATION, {\n    onCompleted: function onCompleted(data) {\n      console.log(data);\n      dispatch({\n        type: \"UPDATE\",\n        payload: data.updateOrganization.organization\n      });\n      setFileError(\"File Uploaded Succesfully!\");\n      setFileLoading(false);\n    },\n    onError: function onError(error) {\n      console.log(error);\n      setFileError(\"Sorry an error occurred. Please try again!\");\n    }\n  }),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      updateFiles = _useMutation4[0];\n\n  var schemas = [{\n    email: Yup.string().email(\"Email not valid\").required(\"Please Enter Your Email\"),\n    focalPerson: Yup.string().required(\"Please Enter Full Name\"),\n    mobileNumber: Yup.string().required(\"Please Enter Your Mobile Number\"),\n    organizationName: Yup.string().required(\"Please Enter Organization Name\"),\n    address: Yup.string().required(\"Please Enter Organization Address\"),\n    registrationNumber: Yup.string(),\n    overview: Yup.string().required(\"Please Enter Your Organization Overiew\"),\n    mission: Yup.string().required(\"Please Enter Your Organization Mission\")\n  }];\n\n  var _useFormik = useFormik({\n    initialValues: {\n      focalPerson: \"\",\n      mobileNumber: \"\",\n      organizationName: \"\",\n      address: \"\",\n      registrationNumber: \"\",\n      overview: \"\",\n      mission: \"\"\n    },\n    onSubmit: function onSubmit(values) {\n      console.log(values);\n      setUpdateLoading(true);\n      setUpdateError(null);\n      setFormValues(values);\n      updateOrganization({\n        variables: {\n          fields: {\n            data: {\n              focalPerson: values.focalPerson,\n              mobileNumber: values.mobileNumber,\n              address: values.address,\n              organizationName: values.organizationName,\n              registrationNumber: values.registrationNumber,\n              overview: values.overview,\n              mission: values.mission\n            },\n            where: {\n              id: organization.id\n            }\n          }\n        }\n      });\n    },\n    validationSchema: Yup.object().shape(schemas[0])\n  }),\n      handleBlur = _useFormik.handleBlur,\n      handleChange = _useFormik.handleChange,\n      handleSubmit = _useFormik.handleSubmit,\n      handleReset = _useFormik.handleReset,\n      values = _useFormik.values,\n      touched = _useFormik.touched,\n      errors = _useFormik.errors,\n      setFieldValue = _useFormik.setFieldValue;\n\n  useEffect(function () {\n    console.log(organization, \"organization\");\n\n    if (organization[\"id\"]) {\n      setFieldValue(\"organizationName\", organization.organizationName);\n      setFieldValue(\"registrationNumber\", organization.registrationNumber);\n      setFieldValue(\"focalPerson\", organization.focalPerson);\n      setFieldValue(\"email\", organization.user.email);\n      setFieldValue(\"address\", organization.address);\n      setFieldValue(\"mobileNumber\", organization.mobileNumber);\n      setFieldValue(\"overview\", organization.overview ? organization.overview : \"\");\n      setFieldValue(\"mission\", organization.mission ? organization.mission : \"\");\n    }\n  }, [organization]);\n\n  var handlefiles = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(files, type) {\n      var form;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(files, type);\n\n              if (!files.length) {\n                _context.next = 14;\n                break;\n              }\n\n              setFileLoading(true);\n              form = new FormData();\n              files.forEach(function (file) {\n                form.append(\"files\", file);\n              });\n              _context.prev = 5;\n              _context.next = 8;\n              return axios.post(\"http://localhost:1337/upload\", form, {\n                headers: {\n                  \"Content-type\": \"multipart/form-data\"\n                }\n              }).then(function (res) {\n                console.log(res.data); //setFileIDs([...filedIds, ...res.data]);\n\n                if (type == \"logo\") {\n                  //setLogo(res.data[0]);\n                  updateFiles({\n                    variables: {\n                      fields: {\n                        data: {\n                          profilePicture: res.data[0].id\n                        },\n                        where: {\n                          id: organization.id\n                        }\n                      }\n                    }\n                  });\n                }\n\n                if (type == \"cover\") {\n                  // setTaxFile(res.data[0]);\n                  updateFiles({\n                    variables: {\n                      fields: {\n                        data: {\n                          profilePicture: res.data[0].id\n                        },\n                        where: {\n                          id: organization.id\n                        }\n                      }\n                    }\n                  });\n                }\n\n                if (type == \"regFile\") {\n                  // setTaxFile(res.data[0]);\n                  updateFiles({\n                    variables: {\n                      fields: {\n                        data: {\n                          registrationCertificate: res.data[0].id\n                        },\n                        where: {\n                          id: organization.id\n                        }\n                      }\n                    }\n                  });\n                }\n\n                if (type == \"taxFile\") {\n                  // setTaxFile(res.data[0]);\n                  updateFiles({\n                    variables: {\n                      fields: {\n                        data: {\n                          taxExemptionForm: res.data[0].id\n                        },\n                        where: {\n                          id: organization.id\n                        }\n                      }\n                    }\n                  });\n                }\n\n                setUpdateLoading(false);\n              });\n\n            case 8:\n              _context.next = 14;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](5);\n              console.log(_context.t0, \"error\");\n              setFileError(\"Sorry an error occurred. Please try again!\");\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[5, 10]]);\n    }));\n\n    return function handlefiles(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleLogout = function handleLogout() {\n    console.log(\"logout called\");\n    cookie.remove(\"token\");\n    dispatch({\n      type: \"LOGOUT\",\n      payload: {}\n    });\n    window.location = \"/\";\n  };\n\n  return __jsx(ThemeProvider, {\n    theme: charityTheme\n  }, __jsx(Fragment, null, __jsx(Head, null, __jsx(\"title\", null, \"My Account | Esaar\"), __jsx(\"meta\", {\n    name: \"Description\",\n    content: \"React next landing page\"\n  }), __jsx(\"meta\", {\n    name: \"theme-color\",\n    content: \"#FCF22B\"\n  }), __jsx(\"meta\", {\n    name: \"viewport\",\n    content: \"width=device-width, initial-scale=1.0\"\n  }), __jsx(\"link\", {\n    href: \"https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800&display=swap\",\n    rel: \"stylesheet\"\n  })), __jsx(ResetCSS, null), __jsx(GlobalStyle, null), __jsx(CharityWrapper, null, __jsx(Sticky, {\n    top: 0,\n    innerZ: 9999,\n    activeClass: \"sticky-nav-active\"\n  }, __jsx(Navbar, null)), __jsx(DrawerProvider, null, __jsx(DrawerSection, null)), __jsx(ContentWrapper, null, __jsx(Grid, {\n    container: true,\n    style: {\n      maxWidth: \"1170px\",\n      minHeight: \"100vh\",\n      paddingTop: \"140px\",\n      marginLeft: \"170px\"\n    }\n  }, __jsx(Grid, {\n    item: true,\n    md: 3\n  }, __jsx(Paper, {\n    style: {\n      height: \"90vh\"\n    }\n  }, __jsx(Container, {\n    style: {\n      padding: \"40px\"\n    }\n  }, __jsx(\"div\", {\n    className: classes.root\n  }, __jsx(List, {\n    component: \"nav\",\n    \"aria-label\": \"main mailbox folders\"\n  }, __jsx(Link, {\n    href: \"/account_o\"\n  }, __jsx(ListItem, {\n    button: true\n  }, __jsx(ListItemIcon, null, __jsx(AccountCircleIcon, null)), __jsx(ListItemText, {\n    primary: \"Account\"\n  }))), __jsx(Divider, null), __jsx(Link, {\n    href: \"/addProject\"\n  }, __jsx(ListItem, {\n    button: true\n  }, __jsx(ListItemIcon, null, __jsx(BusinessCenterIcon, null)), __jsx(ListItemText, {\n    primary: \"Add Project \"\n  }))), __jsx(Divider, null), __jsx(Link, {\n    href: \"/myProjects\"\n  }, __jsx(ListItem, {\n    button: true\n  }, __jsx(ListItemIcon, null, __jsx(AssessmentIcon, null)), __jsx(ListItemText, {\n    primary: \"Projects\"\n  }))), __jsx(Divider, null), __jsx(ListItem, {\n    button: true,\n    onClick: handleLogout\n  }, __jsx(ListItemIcon, null, __jsx(PowerSettingsNewIcon, null)), __jsx(ListItemText, {\n    primary: \"Logout\"\n  }))))))), __jsx(Grid, {\n    item: true,\n    md: 8,\n    style: {\n      marginLeft: \"30px\"\n    }\n  }, __jsx(Paper, {\n    style: {\n      height: \"100%\"\n    }\n  }, __jsx(Container, {\n    style: {\n      padding: \"40px\"\n    }\n  }, \" \", __jsx(Heading, {\n    content: \"Profile\",\n    color: \"#05B890\"\n  }), \" \", __jsx(Divider, null), __jsx(Grid, {\n    container: true\n  }, __jsx(Grid, {\n    item: true,\n    md: 5,\n    style: {\n      marginTop: \"30px\"\n    }\n  }, __jsx(Heading, {\n    content: \"Organization Name\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"organizationName\",\n    value: values.organizationName,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.organizationName && touched.organizationName,\n    helperText: errors.organizationName && touched.organizationName ? errors.organizationName : null,\n    id: \"outlined-basic\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Focal Person\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"focalPerson\",\n    value: values.focalPerson,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.focalPerson && touched.focalPerson,\n    helperText: errors.focalPerson && touched.focalPerson ? errors.focalPerson : null,\n    id: \"outlined-basic\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"small\",\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Email ID\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    type: \"email\",\n    name: \"email\",\n    inputProps: {\n      readOnly: true\n    },\n    value: values.email,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.email && touched.email,\n    helperText: errors.email && touched.email ? errors.email : null,\n    label: \"\",\n    variant: \"outlined\",\n    size: \"small\",\n    style: {\n      color: \"#05B890\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Logo\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(DropzoneArea, {\n    acceptedFiles: [\"image/*\"],\n    dropzoneText: \"Drag and drop images here or click\",\n    onChange: function onChange(files) {\n      return handlefiles(files, \"logo\");\n    }\n  })), __jsx(Grid, {\n    item: true,\n    md: 1\n  }), __jsx(Grid, {\n    item: true,\n    md: 5,\n    style: {\n      marginTop: \"30px\"\n    }\n  }, __jsx(Heading, {\n    content: \"Registration Number\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"registrationNumber\",\n    value: values.registrationNumber,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.registrationNumber && touched.registrationNumber,\n    helperText: errors.registrationNumber && touched.registrationNumber ? errors.registrationNumber : null,\n    id: \"outlined-basic\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"small\",\n    style: {\n      color: \"#3E2672\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Contact Number\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"mobileNumber\",\n    value: values.mobileNumber,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.mobileNumber && touched.mobileNumber,\n    helperText: errors.mobileNumber && touched.mobileNumber ? errors.mobileNumber : null,\n    id: \"outlined-basic\",\n    label: \"\",\n    variant: \"outlined\",\n    size: \"small\",\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Address\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), \" \", __jsx(TextField, {\n    name: \"address\",\n    value: values.address,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.address && touched.address,\n    helperText: errors.address && touched.address ? errors.address : null,\n    id: \"outlined-basic\",\n    label: \"\",\n    variant: \"outlined\",\n    multiline: true,\n    rows: 1,\n    size: \"small\",\n    style: {\n      color: \"#05B890\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Cover\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(DropzoneArea, {\n    acceptedFiles: [\"image/*\"],\n    dropzoneText: \"Drag and drop images here or click\",\n    onChange: function onChange(files) {\n      return handlefiles(files, \"cover\");\n    }\n  })), __jsx(Grid, {\n    container: true,\n    item: true,\n    md: 12,\n    style: {\n      alignContent: \"center\"\n    }\n  }, __jsx(Heading, {\n    content: \"Organization Mission:\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(TextField, {\n    name: \"mission\",\n    value: values.mission,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.mission && touched.mission,\n    helperText: errors.mission && touched.mission ? errors.mission : null,\n    label: \"\",\n    variant: \"outlined\",\n    multiline: true,\n    rows: 8,\n    size: \"small\",\n    style: {\n      color: \"#05B890\"\n    },\n    fullWidth: true\n  }), __jsx(Heading, {\n    content: \"Organization Overview\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(TextField, {\n    name: \"overview\",\n    value: values.overview,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    error: errors.overview && touched.overview,\n    helperText: errors.overview && touched.overview ? errors.overview : null,\n    label: \"\",\n    variant: \"outlined\",\n    multiline: true,\n    rows: 8,\n    size: \"small\",\n    style: {\n      color: \"#05B890\"\n    },\n    fullWidth: true\n  })), __jsx(Grid, {\n    container: true,\n    item: true,\n    md: 12,\n    style: {\n      alignContent: \"center\"\n    }\n  }, updateError ? __jsx(Text, {\n    content: updateError\n  }) : null)), __jsx(Grid, {\n    item: true,\n    md: 12,\n    style: {\n      marginTop: \"30px\"\n    }\n  }, __jsx(Heading, {\n    content: \"Documents\",\n    color: \"#05B890\"\n  }), __jsx(Divider, null), __jsx(Heading, {\n    content: \"Registration Certificate\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(DropzoneArea, {\n    acceptedFiles: [\"image/*\"],\n    dropzoneText: \"Drag and drop images here or click\",\n    onChange: function onChange(files) {\n      return handlefiles(files, \"regFile\");\n    }\n  }), __jsx(Heading, {\n    content: \"Tax Exemption Form\",\n    as: \"h4\",\n    style: {\n      marginTop: \"1rem\"\n    }\n  }), __jsx(DropzoneArea, {\n    acceptedFiles: [\"image/*\"],\n    dropzoneText: \"Drag and drop images here or click\",\n    onChange: function onChange(files) {\n      return handlefiles(files, \"taxFile\");\n    }\n  }), __jsx(Grid, {\n    container: true,\n    item: true,\n    md: 12,\n    style: {\n      alignContent: \"center\"\n    }\n  }, fileError ? __jsx(Text, {\n    content: fileError\n  }) : null), __jsx(Grid, {\n    container: true,\n    item: true,\n    md: 12,\n    style: {\n      alignContent: \"center\"\n    }\n  }, __jsx(Button, {\n    title: \"Update Changes\",\n    variant: \"extendedFab\",\n    onClick: handleSubmit,\n    disabled: updateLoading,\n    isLoading: updateLoading,\n    style: {\n      marginTop: \"20px\",\n      marginLeft: \"230px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      minWidth: \"200px\",\n      height: \"auto\"\n    }\n  })))))))), __jsx(Footer, null))));\n});","map":null,"metadata":{},"sourceType":"module"}